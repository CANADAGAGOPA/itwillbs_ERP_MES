<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.factron.mapper.employee.EmployeeMapper">

    <!-- 테스트 목록 조회 -->
    <select id="com.itwillbs.factron.mapper.employee.EmployeeMapper.getEmployeeList" parameterType="com.itwillbs.factron.dto.employee.EmployeeSearchDTO" resultType="com.itwillbs.factron.dto.employee.ResponseEmployeeDTO">
        SELECT
            e.id AS empId,
            e.name AS empName,
            e.birth || '-' || e.rrn_back AS residentRegistrationNumber,
            e.gender,
            e.email,
            e.edu_level_code,
            edu.name AS eduLevelName,
            e.address,
            e.quit_date,
            e.position_code,
            pos.name AS positionName,
            i.is_active AS empIsActive,
            e.joined_date,
            e.employ_code,
            emp.name AS employeName,
            e.phone,
            e.dept_code,
            dept.name AS deptName
        FROM employee e
        LEFT JOIN intergrat_auth i ON  e.id = i.employee_id
        LEFT JOIN detail_sys_code edu ON e.edu_level_code = edu.detail_code
        LEFT JOIN detail_sys_code pos ON e.position_code = pos.detail_code
        LEFT JOIN detail_sys_code emp ON e.employ_code = emp.detail_code
        LEFT JOIN detail_sys_code dept ON e.dept_code = dept.detail_code
        <where>
            <if test="deptCode != null and deptCode != ''">
                AND dept_code LIKE '%' || #{deptCode} || '%'
            </if>
            <if test="positionCode != null and positionCode != ''">
                AND e.position_code = #{positionCode}
            </if>
            <if test="isActive != null and isActive != ''">
                AND i.is_active = #{isActive}
            </if>
            <if test="name != null and name != ''">
                AND e.name = #{name}
            </if>
            <if test="employeeId != null">
                AND e.id = #{employeeId}
            </if>
        </where>
        ORDER BY e.id DESC
    </select>

</mapper>